{% extends "layout.html" %}

{% block title %}
  SEList - Système d'Échange Local
{% endblock %}

{% block extra_headers %}
<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;

    const installSec = document.getElementById('installSection');
    if (installSec) {
        installSec.style.display = 'inline-block';
    }
});

function installPWA() {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                console.log('User accepted the install prompt');
            }
            deferredPrompt = null;
        });
    }
}

window.addEventListener('appinstalled', () => {
    const installSec = document.getElementById('installSection');
    if (installSec) {
        installSec.style.display = 'none';
    }
});
</script>
{% endblock %}

{% block content %}
<div class="landing-container">
    <div class="landing-hero">
        <h1>Bienvenue sur SEList</h1>
        <p>L'application des Systèmes d'Échange Locaux (SEL) du Pays Mornantais et ses alentours.</p>
        <p>Tissez des liens avec vos voisins en échangeant services et compétences.</p>
    </div>

    <div class="install-section" id="installSection" style="display: none;">
        <h2>Installez l'application</h2>
        <p>Profitez de SEList comme une application native sur votre appareil.</p>

        <button id="installBtn" class="btn btn-primary btn-large" onclick="installPWA()" style="display: inline-block; margin-top: 20px;">
            Installer l'application
        </button>

        <div class="ios-instructions">
            <h3>Sur iOS / Safari :</h3>
            <ol>
                <li>Appuyez sur le bouton "Partager" <strong style="font-size: 1.2em;">⎙</strong> en bas de l'écran (Safari)</li>
                <li>Faites défiler et sélectionnez "Sur l'écran d'accueil"</li>
                <li>Appuyez sur "Ajouter" pour installer l'application</li>
            </ol>
        </div>
    </div>

    {% if user.is_authenticated %}
    <a href="/chat" class="btn btn-primary btn-large">Accéder au chat</a>
    {% else %}
    <div style="margin-top: 20px;">
        <a href="{% url 'users:login' %}" class="btn btn-primary" style="margin: 0 10px;">Se connecter</a>
        <a href="{% url 'users:register' %}" class="btn btn-primary" style="margin: 0 10px;">Créer un compte</a>
    </div>
    {% endif %}
</div>
{% endblock %}